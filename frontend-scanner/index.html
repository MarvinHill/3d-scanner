<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>Document</title>
</head>
<body class="bg-gray-700">
    
    <div class="relative flex flex-col justify-center items-center w-full min-h-screen">
        <div class="flex justify-center pb-4">
            <h1 class="text-3xl font-bold my-4 text-gray-100">Scanner Controller</h1>
        </div>
        <div class="flex flex-col items-center">
            <div class="flex flex-col sm:flex-row gap-2">
                <div class="flex flex-col justify-center items-center mt-4 bg-gray-600 min-w-44 rounded-xl p-4">
                    <h2 class="font-bold text-xl mb-3 text-cente text-gray-200 h-16">Camera Axis</h2>
                    <button id="cameraPlus" class="select-none m-2 size-12 bg-slate-500 hover:bg-blue-400 text-white font-bold py-2 px-4 rounded">+</button>
                    <button id="cameraMinus" class="select-none m-2 size-12 bg-slate-500 hover:bg-blue-400 text-white font-bold py-2 px-4 rounded">-</button>
                </div>
                <div class="flex flex-col justify-center items-center mt-4 bg-gray-600 min-w-44 rounded-xl p-4">
                    <h2 class="font-bold text-xl mb-3 text-cente text-gray-200 h-16">Table Axis</h2>
                    <button id="tablePlus" class="select-none m-2 size-12 bg-slate-500 hover:bg-blue-400 text-white font-bold py-2 px-4 rounded">+</button>
                    <button id="tableMinus" class="select-none m-2 size-12 bg-slate-500 hover:bg-blue-400 text-white font-bold py-2 px-4 rounded">-</button>
                </div>
            </div>
            <button id="levelScanner" class="select-none mt-4 h-12 bg-blue-700 hover:bg-blue-600 text-gray-200 font-bold py-2 px-4 rounded">Level Scanner</button>
            <button id="setScannerLevel" class="select-none mt-4 h-12 bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold py-2 px-4 rounded">Set Level</button>
            <button class="select-none opacity-15 mt-4 h-12 bg-green-700 hover:bg-green-600 text-gray-200 font-bold py-2 px-4 rounded">Start Scanning</button>
            <input type="number" name="cameraAxisCount" id="cameraAxisCount">
            <input type="number" name="tableAxisCount" id="tableAxisCount">
            <button id="startProgram" class="mt-4 h-12 bg-green-700 hover:bg-green-600 text-gray-200 font-bold py-2 px-4 rounded">Start Program</button>
        </div>
    </div>
</body>
<script>

    let interval = null;
    const basePath = "https://scanner.local/scanner";


    function clearInter() {
        if(interval){
            clearInterval(interval);
            interval = null;
        }
    }

    function cameraAxisPlus() {
        interval = setInterval(async () => {
            await fetch(`${basePath}/cameraAxisPlus`)
            console.log("camera axis plus")
        }, 500);
    }
    
    function cameraAxisMinus() {
        interval = setInterval(async () => {
            await fetch(`${basePath}/cameraAxisMinus`)
            console.log("camera axis minus")
        }, 500);
    }

    function tableAxisPlus() {
        interval = setInterval(async () => {
            await fetch(`${basePath}/tableAxisPlus`)
            console.log("table axis plus")
        }, 500);
    }

    function tableAxisMinus() {
        interval = setInterval(async () => {
            await fetch(`${basePath}/tableAxisMinus`)
            console.log("table axis minus")
        }, 500);
    }

    async function levelScanner() {
        await fetch(`${basePath}/levelScanner`)
        console.log("level scanner")
    }
    
    async function setScannerLevel() {
        await fetch(`${basePath}/setScannerLevel`)
        console.log("set scanner level")
    }

    async function takePhoto(angleCameraAxis, angleTableAxis) {
        // await fetch(`${basePath}/takePhoto`, {
        //   body: {
        //     angleCameraAxis: angleCameraAxis,
        //     angleTableAxis: angleTableAxis
        //   }
        // })
        console.log(angleCameraAxis, angleTableAxis)
    }

    async function runProgram() {
      cameraAxisCount = document.querySelector("#cameraAxisCount").value
      tableAxisCount = document.querySelector("#tableAxisCount").value
      cameraDeltaDegrees = 90 / (cameraAxisCount - 1)
      tableDeltaDegrees = 360 / (tableAxisCount - 1)
      
      // await levelScanner()

      for (let i = 0; i < cameraAxisCount; i++) {
        for (let j = 0; j < tableAxisCount; j++) {
          await takePhoto(cameraDeltaDegrees * i, tableDeltaDegrees * j)
        }
      }
    }

    document.querySelector("#cameraPlus").addEventListener("mousedown", cameraAxisPlus)
    document.querySelector("#cameraPlus").addEventListener("mouseup", clearInter)
    document.querySelector("#cameraPlus").addEventListener("touchdown", cameraAxisPlus)
    document.querySelector("#cameraPlus").addEventListener("touchup", clearInter)

    document.querySelector("#cameraMinus").addEventListener("mousedown", cameraAxisMinus)
    document.querySelector("#cameraMinus").addEventListener("mouseup", clearInter)
    document.querySelector("#cameraMinus").addEventListener("touchdown", cameraAxisMinus)
    document.querySelector("#cameraMinus").addEventListener("touchup", clearInter)

    document.querySelector("#tablePlus").addEventListener("mousedown", tableAxisPlus)
    document.querySelector("#tablePlus").addEventListener("mouseup", clearInter)
    document.querySelector("#tablePlus").addEventListener("touchdown", tableAxisPlus)
    document.querySelector("#tablePlus").addEventListener("touchup", clearInter)

    document.querySelector("#tableMinus").addEventListener("mousedown", tableAxisMinus)
    document.querySelector("#tableMinus").addEventListener("mouseup", clearInter)
    document.querySelector("#tableMinus").addEventListener("touchdown", tableAxisMinus)
    document.querySelector("#tableMinus").addEventListener("touchup", clearInter)

    document.querySelector("#levelScanner").addEventListener("click", levelScanner)
    document.querySelector("#setScannerLevel").addEventListener("click", setScannerLevel)

    document.querySelector("#startProgram").addEventListener("click", runProgram)

</script>
</html>